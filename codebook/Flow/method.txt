带下界的网络流问题

问题1：无源汇带上下界可行流
问题描述：有向非简单图G的每条边e都有两个值L[e]与H[e]，现求得一个可行流，使得每条边上的流值都在L[e]和H[e]之间，且对于每个节点v,in_flow(v)=out_flow(v)。
解决方案：重构等价网络流模型G'。对每条在原图中存在的边e，其容量为H[e]-L[e]。对于每个节点v，如果sum(L[in(v)])>sum(L[out(v)])，则从源点引入一条边到v，容量为sum(L[in(v)])-sum(L[out(v)])。如果sum(L[out(v)])>sum(L[in(v)])，则从v连一条边到汇点，容量为sum(L[out(v)])-sum(L[in(v)])。若该图的最大流为满流（s, t都满），则原图存在可行流。
证明：
->：
若G'存在满流，则可根据该满流在原图中得到一个可行流：断开所有与源点、汇点相连的边，并取消这些边上的流，然后对剩余的每条边e（这些边在原图中也存在），每条边增加流值L[e]。
验证：
1. 平衡性：在G'的满流中，对于非源汇点v，in_flow(v)=out_flow(v),即in_flow(v)-out_flow(v)=0。对G'中的流作调整后,in_flow'(v)-out_flow'(v)=(in_flow(v)+sum(L[in(v)]))-(out_flow(v)+sum(L[out(v)]))-（sum(L[in(v)])-sum(L[out(v)]))=in_flow(v)-out_flow(v)=0。因此调整后的流对每个节点依然平衡。
2. 满足下界：在G'中每条边e有flow(e)>=0(注：flow(e)与flow(u, v)概念上不等价)，因此调整回G后，flow'(e)=flow(e)+L[e]>=L[e]。因此每条边都满足下界。
3. 满足上界：在G'中每条边e有capacity(e)+L[e]=H[e],因此对于G'的满流，有flow(e)+L[e]<=H[e]。因此在G中的每条边流值都不超过上界。
<-：若原图G存在可行流，通过对G中每条边减去L[e]的流，同时使源汇达到满流，可以得到G'的一个可行满流。反向验证同上。
证毕。


问题2：有源汇带上下界可行流
问题描述：存在源点s与汇点t，每条边e有两个值L[e]与H[e]，询问是否存在s->t可行流，使得每条边流值在L[e]和H[e]之间。
解决方案：添加一条边t->s, L[t->s]=0, H[t->s]=inf。若新图存在无源汇可行流，原图有对应解。
证明：对任意网络流，连上t->s即是无源汇可行流。任意无源汇可行流，断开任意一条有流的边，即是一个有源汇可行流。
证毕。

问题3：有源汇带上下界最大流
解决方案：令原图的源点为s，汇点为t。将原图转换为等价的无源汇图，再转换为求无源汇可行流等价的网络流模型G'。令ss为G'的源点，tt为G'的汇点。先求出G'的最大流（若最大流非满流则无解），再断开t->s，基于当前残余网络求出s->t最大流，最后将该网络流转换回等价图G的有源汇最大流。
证明：
->：若G'满流，并进一步求出了s->t的最大流
1. G的等价网络平衡性：由于ss, tt满流，因此在求s->t的最大流时，不存在经过ss或tt的增广路。因此对于任意非s, t节点，求s->t最大流前与s->t最大流后flow(ss, v)+flow(v, tt)始终等于sum(L[in(v)])-sum(L[out(v)])。因此，v在流量等价的G中依然保持流量平衡。
2. G的等价网络流不存在s到t的增广路：对于G中任意边e，其残余边容量c'(e)=H[e]-flow'(e)=H[e]-L[e]-flow(e)=capacity(e)-flow(e)=c(e)。因此与该边在G'中的残余容量相等。因此G中残余网络（与G'残余网络删除ss, tt等价）不存在s到t增广路。
3. G的等价网络满足上下界：证明与问题1相同。
<-：G的任意满足上下界的s-t最大流也可转化成唯一的等价G'无源汇可行流。反向验证同上（只需1,3)。
注：在实际算法中，可以通过不断开t->s直接求一次最大流得到该流值。

问题4：有源汇带上下界最小流
解决方案：令原图的源点为s，汇点为t。将原图转换为等价的无源汇图，再转换为求无源汇可行流的等价网络流模型G'。令ss为G'的源点，tt为G'的汇点。先求出G'的最大流（若最大流非满流则无解），再断开t->s，基于当前残余网络求出t->s最大流，最后将该网络流转换回等价图G的有源汇最小流。
证明：若G'满流，并进一步求出了t->s的最大流，等价图G满足平衡性与上下界，且不存在t->s的增广路（退流路径）。
注：在实际算法中，可以通过断开t->s，求得最大流f后由flow(t->s)-f直接得到答案。(若flow(t->s)-f小于0，说明强制流入t的流都可以流回s，因此此时输出0）。

问题5：无源汇有上下界最小费用可行流
解决方案：构造等价网络流G'，新加入的边费用都为0，该图的最小费用满流为答案。否则无解。
证明：若存在更优解，更优解一定在G'中有一对应的满流，且费用更小（最小费用最大流的残量网络不存在负权环，因此矛盾）。

问题6：有源汇有上下界最小费用可行流/有源汇最小费用最大流
解决方案：构造等价网络流G'，新加入的边费用都为0。等价图存在最小费用满流则有解。若求最小费用最大流，再对s->t求一次最小费用最大流（求之前断开t->s）。
证明：可行流证明略。在等价图中求得最小费用可行流后，残量网络一定不存在负权环，因此可以继续求s->t的最小费用最大流。

问题7：有源汇有上下界最小费用最小流
解决方案：构造等价网络流G'，新加入的边费用都为0，除t->s，该边费用为max(cost(e))*|E|+1。求得最小费用可行流后，该可行流即为最小费用最小流，注意费用值需要减去flow(t->e)*cost(t->e)。该方法也可用来求有源汇带下界最小流。
